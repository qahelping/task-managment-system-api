<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
  <link rel="icon" type="image/png" href="../../assets/favicon.png">

    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>React-like controlled input (value resets) - Web Automation Torture Lab</title>
        <!-- –ë–∞–∑–æ–≤—ã–µ —Å—Ç–∏–ª–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã/–∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ -->
    <link rel="stylesheet" href="../../assets/indigo-styles.css"/>

    <!-- –§–æ–Ω —Å—Ç—Ä–∞–Ω–∏—Ü—ã: –ø–µ—Ä–µ–ª–∏–≤—ã/–≤–æ–ª–Ω—ã/–∞—É—Ä–∞/–∑–≤—ë–∑–¥—ã (–ø–æ–¥–∫–ª—é—á–∞—Ç—å –ü–û–°–õ–ï –±–∞–∑–æ–≤—ã—Ö) -->
    <link rel="stylesheet" href="../../assets/aurora.css"/>
</head>
<body data-style="s2">
<!-- –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ —Å–ª–æ–∏ –¥–ª—è –∑–≤—ë–∑–¥ -->
<div class="sky" aria-hidden="true"></div>
<div class="layout">
        <header class="header">
            <div class="header-content">
                <div class="brand">
                <div class="brand-mark"><img src="../../assets/logo.png" alt="Logo" class="brand-logo-img"></div>
                <div class="brand-text">
                    <div class="brand-title">Web Automation Torture Lab</div>
                </div>
            </div>
                <button class="theme-toggle" id="themeToggle" aria-label="–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å —Ç–µ–º—É">
                    <span class="theme-icon">üåô</span>
                </button>
            </div>
        </header>

        

        <main class="main">
            <div class="container">
                <a href="../forms.html" class="back-link">–ù–∞–∑–∞–¥</a>
                <div class="page-header">
                    <a href="../forms.html" class="nav-link" style="display: inline-block; margin-bottom: 1rem; text-decoration: none;">‚Üê –ù–∞–∑–∞–¥ –∫ Forms & Inputs</a>
                    <h2 class="page-title">React-like controlled input (value resets)</h2>
                    <p class="page-description">–ö–∞—Ç–µ–≥–æ—Ä–∏—è: Forms & Inputs</p>
                </div>

                <div class="stress-controls">
                    <button class="stress-btn" id="stressToggle">Toggle Stress Mode</button>
                </div>

                <div class="case-card" style="max-width: 1000px; margin: 0 auto;">
                    <h3 class="case-title">React-like controlled input (value resets)</h3>
                    
                    <div class="case-element" id="case-element">
                        <label>–ë—ã—Å—Ç—Ä—ã–π –≤–≤–æ–¥:</label>
                        <input type="text" id="controlled-input" style="width: 100%; padding: 0.75rem; border: 2px solid var(--border-color); border-radius: 8px; margin-top: 0.5rem;">
                        <div id="controlled-status" style="margin-top: 0.5rem; color: var(--text-secondary);"></div>
                    </div>

                    <div class="problem-section">
                        <span class="section-label problem-label">Problem</span>
                        <div class="section-content">
                            –ü–æ–ª–µ –Ω–∞ –∫–∞–∂–¥–æ–º keypress –ø–µ—Ä–µ—Ä–µ–Ω–¥–µ—Ä–∏–≤–∞–µ—Ç—Å—è –∏ –∏–Ω–æ–≥–¥–∞ —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç value –µ—Å–ª–∏ –≤–≤–æ–¥ —Å–ª–∏—à–∫–æ–º –±—ã—Å—Ç—Ä—ã–π. Flaky input.
                        </div>
                    </div>

                    <div class="problem-section">
                        <span class="section-label why-label">Why it happens</span>
                        <div class="section-content">
                            Controlled –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É—é—Ç value —á–µ—Ä–µ–∑ state. –ë—ã—Å—Ç—Ä—ã–π –≤–≤–æ–¥ –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ race condition –º–µ–∂–¥—É —Å–æ–±—ã—Ç–∏—è–º–∏ –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏—è.
                        </div>
                    </div>

                    <div class="show-solution-wrapper">
                        <input type="text" class="solution-key-input" placeholder="–í–≤–µ–¥–∏—Ç–µ –∫–ª—é—á –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Ä–µ—à–µ–Ω–∏—è">
                        <button class="show-solution-btn" disabled>–ü–æ–∫–∞–∑–∞—Ç—å —Ä–µ—à–µ–Ω–∏–µ</button>
                    </div>

                    <div class="solution-section solution-hidden">
                        <span class="section-label solution-label">Solution: Selenium (Python)</span>
                        <div class="code-wrapper">
                            <div class="code-header">
                                <span class="code-label">Selenium (Python)</span>
                                <button class="copy-btn" onclick="copyToClipboard(`from selenium.webdriver.common.by import By
from selenium.webdriver.support.ui import WebDriverWait
from selenium.webdriver.support import expected_conditions as EC
import time

controlled_input = driver.find_element(By.ID, 'controlled-input')

# –í–∞—Ä–∏–∞–Ω—Ç 1: –ú–µ–¥–ª–µ–Ω–Ω—ã–π –≤–≤–æ–¥ —Å –∑–∞–¥–µ—Ä–∂–∫–∞–º–∏
text = 'Test Value'
for char in text:
    controlled_input.send_keys(char)
    time.sleep(0.2)  # –ó–∞–¥–µ—Ä–∂–∫–∞ –º–µ–∂–¥—É —Å–∏–º–≤–æ–ª–∞–º–∏
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –∑–Ω–∞—á–µ–Ω–∏–µ –Ω–µ —Å–±—Ä–æ—Å–∏–ª–æ—Å—å
    current_value = controlled_input.get_attribute('value')
    if not current_value or len(current_value) < len(text[:text.index(char) + 1]):
        # –ü–æ–≤—Ç–æ—Ä—è–µ–º –≤–≤–æ–¥ —Å–∏–º–≤–æ–ª–∞
        controlled_input.send_keys(char)

# –í–∞—Ä–∏–∞–Ω—Ç 2: –û—á–∏—Å—Ç–∏—Ç—å, –≤–≤–µ—Å—Ç–∏ –≤—Å—ë —Å—Ä–∞–∑—É, –ø–æ–¥–æ–∂–¥–∞—Ç—å —Å—Ç–∞–±–∏–ª–∏–∑–∞—Ü–∏–∏
controlled_input.clear()
controlled_input.send_keys(text)
time.sleep(0.5)  # –î–∞—ë–º –≤—Ä–µ–º—è –Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫—É

# –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ñ–∏–Ω–∞–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
WebDriverWait(driver, 5).until(
    lambda d: d.find_element(By.ID, 'controlled-input').get_attribute('value') == text
)`, this)">Copy</button>
                            </div>
                            <pre class="code-block">from selenium.webdriver.common.by import By
from selenium.webdriver.support.ui import WebDriverWait
from selenium.webdriver.support import expected_conditions as EC
import time

controlled_input = driver.find_element(By.ID, 'controlled-input')

# –í–∞—Ä–∏–∞–Ω—Ç 1: –ú–µ–¥–ª–µ–Ω–Ω—ã–π –≤–≤–æ–¥ —Å –∑–∞–¥–µ—Ä–∂–∫–∞–º–∏
text = 'Test Value'
for char in text:
    controlled_input.send_keys(char)
    time.sleep(0.2)  # –ó–∞–¥–µ—Ä–∂–∫–∞ –º–µ–∂–¥—É —Å–∏–º–≤–æ–ª–∞–º–∏
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –∑–Ω–∞—á–µ–Ω–∏–µ –Ω–µ —Å–±—Ä–æ—Å–∏–ª–æ—Å—å
    current_value = controlled_input.get_attribute('value')
    if not current_value or len(current_value) < len(text[:text.index(char) + 1]):
        # –ü–æ–≤—Ç–æ—Ä—è–µ–º –≤–≤–æ–¥ —Å–∏–º–≤–æ–ª–∞
        controlled_input.send_keys(char)

# –í–∞—Ä–∏–∞–Ω—Ç 2: –û—á–∏—Å—Ç–∏—Ç—å, –≤–≤–µ—Å—Ç–∏ –≤—Å—ë —Å—Ä–∞–∑—É, –ø–æ–¥–æ–∂–¥–∞—Ç—å —Å—Ç–∞–±–∏–ª–∏–∑–∞—Ü–∏–∏
controlled_input.clear()
controlled_input.send_keys(text)
time.sleep(0.5)  # –î–∞—ë–º –≤—Ä–µ–º—è –Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫—É

# –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ñ–∏–Ω–∞–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
WebDriverWait(driver, 5).until(
    lambda d: d.find_element(By.ID, 'controlled-input').get_attribute('value') == text
)</pre>
                        </div>
                    </div>

                    <div class="solution-section solution-hidden">
                        <span class="section-label solution-label">Solution: Playwright (TypeScript)</span>
                        <div class="code-wrapper">
                            <div class="code-header">
                                <span class="code-label">Playwright (TypeScript)</span>
                                <button class="copy-btn" onclick="copyToClipboard(`const controlledInput = page.locator('#controlled-input');
const text = 'Test Value';

// –í–∞—Ä–∏–∞–Ω—Ç 1: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å fill + waitForTimeout –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π
await controlledInput.fill(text);
await page.waitForTimeout(100); // –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –¥–ª—è —Å—Ç–∞–±–∏–ª–∏–∑–∞—Ü–∏–∏

// –í–∞—Ä–∏–∞–Ω—Ç 2: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å type —Å delay
await controlledInput.clear();
await controlledInput.type(text, { delay: 150 });

// –í–∞—Ä–∏–∞–Ω—Ç 3: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å expect.poll –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ñ–∏–Ω–∞–ª—å–Ω–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è
await expect.poll(async () => {
    await controlledInput.fill(text);
    return await controlledInput.inputValue();
}, {
    timeout: 5000
}).toBe(text);`, this)">Copy</button>
                            </div>
                            <pre class="code-block">const controlledInput = page.locator('#controlled-input');
const text = 'Test Value';

// –í–∞—Ä–∏–∞–Ω—Ç 1: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å fill + waitForTimeout –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π
await controlledInput.fill(text);
await page.waitForTimeout(100); // –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –¥–ª—è —Å—Ç–∞–±–∏–ª–∏–∑–∞—Ü–∏–∏

// –í–∞—Ä–∏–∞–Ω—Ç 2: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å type —Å delay
await controlledInput.clear();
await controlledInput.type(text, { delay: 150 });

// –í–∞—Ä–∏–∞–Ω—Ç 3: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å expect.poll –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ñ–∏–Ω–∞–ª—å–Ω–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è
await expect.poll(async () => {
    await controlledInput.fill(text);
    return await controlledInput.inputValue();
}, {
    timeout: 5000
}).toBe(text);</pre>
                        </div>
                    </div>

                    <button class="trigger-btn" onclick="triggerCase()">Trigger</button>

                    <div class="assert-section solution-hidden">
                        <div class="assert-title">How to assert it's fixed:</div>
                        <p>–ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –∑–Ω–∞—á–µ–Ω–∏–µ —Å—Ç–∞–±–∏–ª—å–Ω–æ –∏ –Ω–µ —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç—Å—è</p>
                    </div>
                </div>
            </div>
        </main>

        <footer class="footer">
            <p>Web Automation Torture Lab ¬© <span id="currentYear">2024</span> | –î–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ç–æ—Ä–æ–≤ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è</p>
        </footer>
    </div>





    <script src="../../assets/highlight.js"></script>
    <script src="../../assets/app.js"></script>
    <script>
        // Case-specific handler
        function triggerCase() {
            const input = document.getElementById('controlled-input');
            const status = document.getElementById('controlled-status');
            let renderCount = 0;
            
            // –°–∏–º—É–ª—è—Ü–∏—è controlled input —Å –ø–µ—Ä–µ—Ä–µ–Ω–¥–µ—Ä–æ–º
            input.addEventListener('input', function() {
                renderCount++;
                // –ò–Ω–æ–≥–¥–∞ —Å–±—Ä–∞—Å—ã–≤–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ –ø—Ä–∏ –±—ã—Å—Ç—Ä–æ–º –≤–≤–æ–¥–µ
                if (renderCount % 3 === 0 && Math.random() > 0.7) {
                    const currentValue = input.value;
                    input.value = '';
                    setTimeout(() => {
                        input.value = currentValue;
                    }, 50);
                }
                status.textContent = `Render count: ${renderCount}, Value: ${input.value}`;
            });
            
            // –¢—Ä–∏–≥–≥–µ—Ä–∏–º –±—ã—Å—Ç—Ä—ã–π –≤–≤–æ–¥
            const text = 'Test Value';
            for (let i = 0; i < text.length; i++) {
                setTimeout(() => {
                    input.value += text[i];
                    input.dispatchEvent(new Event('input', { bubbles: true }));
                }, i * 50);
            }
        }

        // Stress mode toggle
        document.getElementById('stressToggle')?.addEventListener('click', function() {
            window.stressMode.toggle();
            this.classList.toggle('active');
            this.textContent = window.stressMode.enabled ? 'Stress Mode: ON' : 'Stress Mode: OFF';
        });
    </script>
</body>
</html>

